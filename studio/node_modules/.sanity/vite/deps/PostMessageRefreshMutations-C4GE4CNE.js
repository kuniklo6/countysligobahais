import {
  getPublishedId,
  useEditState,
  usePerspective
} from "./chunk-5GYIARJV.js";
import "./chunk-WHINAGMC.js";
import "./chunk-GWSOWVM6.js";
import "./chunk-YEPYLXU5.js";
import "./chunk-GFBILRLQ.js";
import "./chunk-QMHE5CX6.js";
import "./chunk-OF6A7363.js";
import {
  require_compiler_runtime
} from "./chunk-5I4Y4JKH.js";
import {
  require_jsx_runtime
} from "./chunk-GRLST4WI.js";
import "./chunk-ZRQFOE7A.js";
import {
  require_react
} from "./chunk-3SNRL2IO.js";
import {
  __toESM
} from "./chunk-V4OQ3NZ2.js";

// node_modules/sanity/lib/_chunks-es/PostMessageRefreshMutations.js
var import_jsx_runtime = __toESM(require_jsx_runtime(), 1);
var import_compiler_runtime = __toESM(require_compiler_runtime(), 1);
var import_react = __toESM(require_react(), 1);
function PostMessageRefreshMutations(props) {
  const $ = (0, import_compiler_runtime.c)(9), {
    comlink,
    type,
    previewKitConnection,
    loadersConnection
  } = props;
  let t0;
  $[0] !== props.id ? (t0 = getPublishedId(props.id), $[0] = props.id, $[1] = t0) : t0 = $[1];
  const id = t0, {
    selectedReleaseId
  } = usePerspective(), {
    draft,
    published,
    ready,
    version
  } = useEditState(id, type, "low", selectedReleaseId), livePreviewEnabled = previewKitConnection === "connected" || loadersConnection === "connected";
  if (ready && draft || published) {
    let t1;
    return $[2] !== comlink || $[3] !== draft || $[4] !== id || $[5] !== livePreviewEnabled || $[6] !== published || $[7] !== version ? (t1 = (0, import_jsx_runtime.jsx)(PostMessageRefreshMutationsInner, { comlink, draft, livePreviewEnabled, published, version }, id), $[2] = comlink, $[3] = draft, $[4] = id, $[5] = livePreviewEnabled, $[6] = published, $[7] = version, $[8] = t1) : t1 = $[8], t1;
  }
  return null;
}
function PostMessageRefreshMutationsInner(props) {
  const $ = (0, import_compiler_runtime.c)(18), {
    comlink,
    draft,
    published,
    livePreviewEnabled,
    version
  } = props, [prevDraft, setPrevDraft] = (0, import_react.useState)(draft), [prevPublished, setPrevPublished] = (0, import_react.useState)(published), [prevVersion, setPrevVersion] = (0, import_react.useState)(version);
  let t0;
  $[0] !== comlink || $[1] !== draft || $[2] !== livePreviewEnabled || $[3] !== prevDraft?._rev || $[4] !== prevPublished?._rev || $[5] !== prevVersion?._rev || $[6] !== published || $[7] !== version ? (t0 = () => {
    prevVersion?._rev !== version?._rev && ((0, import_react.startTransition)(() => setPrevVersion(version)), version && comlink?.post("presentation/refresh", {
      source: "mutation",
      livePreviewEnabled,
      document: parseDocument(version)
    })), prevDraft?._rev !== draft?._rev && ((0, import_react.startTransition)(() => setPrevDraft(draft)), draft && comlink?.post("presentation/refresh", {
      source: "mutation",
      livePreviewEnabled,
      document: parseDocument(draft)
    })), prevPublished?._rev !== published?._rev && ((0, import_react.startTransition)(() => setPrevPublished(published)), published && comlink?.post("presentation/refresh", {
      source: "mutation",
      livePreviewEnabled,
      document: parseDocument(published)
    }));
  }, $[0] = comlink, $[1] = draft, $[2] = livePreviewEnabled, $[3] = prevDraft?._rev, $[4] = prevPublished?._rev, $[5] = prevVersion?._rev, $[6] = published, $[7] = version, $[8] = t0) : t0 = $[8];
  const t1 = prevDraft?._rev, t2 = prevPublished?._rev, t3 = prevVersion?._rev;
  let t4;
  return $[9] !== comlink || $[10] !== draft || $[11] !== livePreviewEnabled || $[12] !== published || $[13] !== t1 || $[14] !== t2 || $[15] !== t3 || $[16] !== version ? (t4 = [comlink, draft, livePreviewEnabled, t1, t2, published, t3, version], $[9] = comlink, $[10] = draft, $[11] = livePreviewEnabled, $[12] = published, $[13] = t1, $[14] = t2, $[15] = t3, $[16] = version, $[17] = t4) : t4 = $[17], (0, import_react.useEffect)(t0, t4), null;
}
function parseDocument(document) {
  const {
    _id,
    _type,
    _rev,
    slug
  } = document;
  return {
    _id,
    _type,
    _rev,
    slug
  };
}
var PostMessageRefreshMutations_default = (0, import_react.memo)(PostMessageRefreshMutations);
export {
  PostMessageRefreshMutations_default as default
};
//# sourceMappingURL=PostMessageRefreshMutations-C4GE4CNE.js.map
