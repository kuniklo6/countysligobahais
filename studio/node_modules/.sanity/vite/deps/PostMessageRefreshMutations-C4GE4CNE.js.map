{
  "version": 3,
  "sources": ["../../../sanity/src/presentation/editor/PostMessageRefreshMutations.tsx"],
  "sourcesContent": ["import {memo, startTransition, useEffect, useMemo, useState} from 'react'\nimport {getPublishedId, type SanityDocument, useEditState, usePerspective} from 'sanity'\n\nimport {type ConnectionStatus, type VisualEditingConnection} from '../types'\n\nexport interface PostMessageRefreshMutationsProps {\n  id: string\n  type: string\n  comlink: VisualEditingConnection\n  previewKitConnection: ConnectionStatus\n  loadersConnection: ConnectionStatus\n}\n\nfunction PostMessageRefreshMutations(props: PostMessageRefreshMutationsProps): React.ReactNode {\n  const {comlink, type, previewKitConnection, loadersConnection} = props\n  const id = useMemo(() => getPublishedId(props.id), [props.id])\n  const {selectedReleaseId} = usePerspective()\n  const {draft, published, ready, version} = useEditState(id, type, 'low', selectedReleaseId)\n  const livePreviewEnabled =\n    previewKitConnection === 'connected' || loadersConnection === 'connected'\n\n  if ((ready && draft) || published) {\n    return (\n      <PostMessageRefreshMutationsInner\n        key={id}\n        comlink={comlink}\n        draft={draft}\n        livePreviewEnabled={livePreviewEnabled}\n        published={published}\n        version={version}\n      />\n    )\n  }\n\n  return null\n}\n\ninterface PostMessageRefreshMutationsInnerProps extends Pick<\n  PostMessageRefreshMutationsProps,\n  'comlink'\n> {\n  livePreviewEnabled: boolean\n  draft: SanityDocument | null\n  published: SanityDocument | null\n  version: SanityDocument | null\n}\nfunction PostMessageRefreshMutationsInner(props: PostMessageRefreshMutationsInnerProps) {\n  const {comlink, draft, published, livePreviewEnabled, version} = props\n  const [prevDraft, setPrevDraft] = useState(draft)\n  const [prevPublished, setPrevPublished] = useState(published)\n  const [prevVersion, setPrevVersion] = useState(version)\n\n  useEffect(() => {\n    if (prevVersion?._rev !== version?._rev) {\n      startTransition(() => setPrevVersion(version))\n      if (version) {\n        comlink?.post('presentation/refresh', {\n          source: 'mutation',\n          livePreviewEnabled,\n          document: parseDocument(version),\n        })\n      }\n    }\n    if (prevDraft?._rev !== draft?._rev) {\n      startTransition(() => setPrevDraft(draft))\n      if (draft) {\n        comlink?.post('presentation/refresh', {\n          source: 'mutation',\n          livePreviewEnabled,\n          document: parseDocument(draft),\n        })\n      }\n    }\n    if (prevPublished?._rev !== published?._rev) {\n      startTransition(() => setPrevPublished(published))\n      if (published) {\n        comlink?.post('presentation/refresh', {\n          source: 'mutation',\n          livePreviewEnabled,\n          document: parseDocument(published),\n        })\n      }\n    }\n  }, [\n    comlink,\n    draft,\n    livePreviewEnabled,\n    prevDraft?._rev,\n    prevPublished?._rev,\n    published,\n    prevVersion?._rev,\n    version,\n  ])\n\n  return null\n}\n\nfunction parseDocument(document: SanityDocument & {slug?: {current?: string | null}}): {\n  _id: string\n  _type: string\n  _rev: string\n  slug?: {current?: string | null}\n} {\n  const {_id, _type, _rev, slug} = document\n  return {_id, _type, _rev, slug}\n}\n\nexport default memo(PostMessageRefreshMutations)\n"],
  "mappings": "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",
  "names": ["PostMessageRefreshMutations", "props", "$", "_c", "comlink", "type", "previewKitConnection", "loadersConnection", "t0", "id", "getPublishedId", "selectedReleaseId", "usePerspective", "draft", "published", "ready", "version", "useEditState", "livePreviewEnabled", "t1", "PostMessageRefreshMutationsInner", "prevDraft", "setPrevDraft", "useState", "prevPublished", "setPrevPublished", "prevVersion", "setPrevVersion", "_rev", "startTransition", "post", "source", "document", "parseDocument", "t2", "t3", "t4", "useEffect", "_id", "_type", "slug", "memo"]
}
